Ansar Ahmed
ULTIMATE DESIGN TECHNOLOGY LLP
EE
1173919287
1173919287
Mumbai
ansar@mail.com



make parameter dynamic

and check pagination code sort all data this code sort current page data only
when i go to next page then it not return next sorted data it return constant data that belong to that page

we have google.html file write render function to render html file 
*********************







***************************888

# views.py
from rest_framework.views import APIView
from rest_framework.response import Response
from rest_framework import status
from google.oauth2 import id_token
from google.auth.transport import requests
from django.conf import settings
from .models import CustomUser
from rest_framework_simplejwt.tokens import RefreshToken

class GoogleLogin(APIView):
    def post(self, request):
        token = request.data.get("token")

        try:
            # Verify the token with Google's servers
            idinfo = id_token.verify_oauth2_token(token, requests.Request(), settings.GOOGLE_CLIENT_ID)

            if idinfo['iss'] not in ['accounts.google.com', 'https://accounts.google.com']:
                raise ValueError('Wrong issuer.')

            # Get user info from the token
            google_id = idinfo['sub']
            email = idinfo['email']
            name = idinfo['name']

            # Check if the user already exists, otherwise create one
            user, created = CustomUser.objects.get_or_create(
                google_id=google_id,
                defaults={'email': email, 'name': name, 'username': email.split('@')[0]}
            )

            # Generate JWT for the user
            refresh = RefreshToken.for_user(user)

            return Response({
                'refresh': str(refresh),
                'access': str(refresh.access_token),
            }, status=status.HTTP_200_OK)

        except ValueError:
            return Response({'error': 'Invalid token'}, status=status.HTTP_400_BAD_REQUEST)


            # settings.py
            REST_FRAMEWORK = {
                'DEFAULT_AUTHENTICATION_CLASSES': (
                    'rest_framework_simplejwt.authentication.JWTAuthentication',
                ),
            }
            
            SIMPLE_JWT = {
                'AUTH_HEADER_TYPES': ('Bearer',),
            }
            
            # Add your Google OAuth credentials
            GOOGLE_CLIENT_ID = 'your-google-client-id.apps.googleusercontent.com'


    pip install djangorestframework-simplejwt google-auth google-auth-oauthlib


            # models.py
            from django.db import models
            from django.contrib.auth.models import AbstractUser
            
            class CustomUser(AbstractUser):
                google_id = models.CharField(max_length=255, unique=True)
                email = models.EmailField(unique=True)
                name = models.CharField(max_length=255)



in this api data store into user model but i want to store name,email,password into following model instead of user model "@api_view(['POST'])
def google_login_or_register(request):
    email = request.data.get('email')
    display_name = request.data.get('display_name')

    if not email:
        return Response({'error': 'Email is required'}, status=status.HTTP_400_BAD_REQUEST)

    try:
        # Check if the user already exists in the database
        user = User.objects.get(email=email)
        return Response({
            'message': 'User logged in successfully',
            'email': user.email,
        }, status=status.HTTP_200_OK)
    except User.DoesNotExist:
        # If user doesn't exist, create a new user
        user = User.objects.create(
            username=display_name,
            email=email,
            password=User.objects.make_random_password()  # Random password as it's a Google user
        )
        return Response({
            'message': 'User registered successfully',
            'email': user.email,
        }, status=status.HTTP_201_CREATED)"

i want to use save data in this model "class UserEnrolled(models.Model):
sr = models.AutoField(primary_key=True, unique=True)
picture = models.ImageField(upload_to='user_pictures/', blank=True, null=True)
name = models.CharField(max_length=255)
company_name = models.CharField(max_length=100)
job_role = models.CharField(max_length=100)
mycompany_id = models.CharField(max_length=10)  # this is SST ID
tag_id = models.CharField(max_length=50,blank=True, null=True)
job_location = models.CharField(max_length=100)
orientation = models.FileField(upload_to='attachments/', blank=True, null=True, validators=[FileExtensionValidator(['jpeg', 'jpg'])])
facial_data = models.ImageField(upload_to=user_image_upload_path, blank=True, null=True, verbose_name='Facial Data')
my_comply = models.ImageField(upload_to='compliance_images/', blank=True, null=True) # this is SST
expiry_date = models.DateField(blank=True, null=True)
status = models.CharField(max_length=100, choices=[
    ('active', 'Active'),
    ('inactive', 'Inactive'),
    ('pending', 'Pending'),
], default='pending')
email = models.EmailField()
password = models.CharField(max_length=50)
site = models.ForeignKey('Site', on_delete=models.CASCADE, blank=True, null=True)

def __str__(self):
    return self.name

def get_folder_name(self):
    return self.name

def set_password(self, raw_password):
    self.password = make_password(raw_password)

def check_password(self, raw_password):
    return check_password(raw_password, self.password)"



************************
from django.contrib.auth.hashers import make_password
from django.utils.text import slugify
from .models import UserEnrolled

@api_view(['POST'])
def google_login_or_register(request):
    email = request.data.get('email')
    display_name = request.data.get('display_name')

    if not email:
        return Response({'error': 'Email is required'}, status=status.HTTP_400_BAD_REQUEST)

    try:
        # Check if the user already exists in the database
        user_enrolled = UserEnrolled.objects.get(email=email)
        return Response({
            'message': 'User logged in successfully',
            'email': user_enrolled.email,
        }, status=status.HTTP_200_OK)
    except UserEnrolled.DoesNotExist:
        # If user doesn't exist, create a new user
        user_enrolled = UserEnrolled(
            name=display_name,
            email=email,
            password=make_password(None),  # Random password as it's a Google user
            status='active',  # You might want to set a default status
        )
        user_enrolled.save()
        return Response({
            'message': 'User registered successfully',
            'email': user_enrolled.email,
        }, status=status.HTTP_201_CREATED)



        {"username":"tabish5","email":"tabish5@gmail.com"}


*******************************




    
{"display_Name": "Design Master", "email": "designs4it@gmail.com", "id": 115189392888513766232, "photoUrl": null, "serverAuthCode": null}