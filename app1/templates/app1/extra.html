Ansar Ahmed
ULTIMATE DESIGN TECHNOLOGY LLP
EE
1173919287
1173919287
Mumbai
ansar@mail.com

api for forget google password

brlu jnao dbln phia

brlujnaodblnphia


make parameter dynamic

and check pagination code sort all data this code sort current page data only
when i go to next page then it not return next sorted data it return constant data that belong to that page

we have google.html file write render function to render html file 


import pickle
import os
import random
import cv2
import face_recognition
from imutils import paths
from rest_framework.views import APIView
from rest_framework.response import Response
from rest_framework import status
from django.conf import settings
from .serializers import FacialImageDataSerializer
from .models import UserEnrolled


class FacialDataApi(APIView):
    def post(self, request):
        serializer = FacialImageDataSerializer(data=request.data)
        if serializer.is_valid():
            email = serializer.validated_data['email']
            images = serializer.validated_data['facial_data']
            uploaded_image_paths = []  # Store paths of new images

            try:
                user = UserEnrolled.objects.get(email=email)
                user_folder = os.path.join(settings.MEDIA_ROOT, 'facial_data', str(user.name))
                os.makedirs(user_folder, exist_ok=True)  # Ensure the folder exists
                
                for image in images:
                    # Save each image to the user's folder
                    image_path = os.path.join(user_folder, image.name)
                    with open(image_path, 'wb') as img_file:
                        for chunk in image.chunks():
                            img_file.write(chunk)
                    uploaded_image_paths.append(image_path)  # Track the uploaded image paths

                if uploaded_image_paths:
                    # Set one of the newly uploaded images as the user's picture
                    random_image = random.choice(uploaded_image_paths)
                    user.picture = os.path.basename(random_image)
                    user.save()

            except UserEnrolled.DoesNotExist:
                return Response("User not found", status=status.HTTP_404_NOT_FOUND)

            # Pass only the new images to be processed for facial recognition
            self.update_pickle(uploaded_image_paths)

            return Response("Images uploaded and facial data updated successfully", status=status.HTTP_200_OK)

        return Response(serializer.errors, status=status.HTTP_400_BAD_REQUEST)

    def update_pickle(self, uploaded_image_paths):
        if not uploaded_image_paths:
            print("No new images to process.")
            return

        # Assume all images are saved in the same user folder
        user_folder = os.path.dirname(uploaded_image_paths[0])
        pickle_file_path = os.path.join(user_folder, 'encodings.pickle')

        knownEncodings = []
        knownNames = []

        print(f"New images to process: {len(uploaded_image_paths)}")

        for (i, imagePath) in enumerate(uploaded_image_paths):
            print(f"--> processing image {i + 1}/{len(uploaded_image_paths)}")
            name = os.path.basename(os.path.dirname(imagePath))

            image = cv2.imread(imagePath)
            rgb = cv2.cvtColor(image, cv2.COLOR_BGR2RGB)

            boxes = face_recognition.face_locations(rgb, model="hog")
            encodings = face_recognition.face_encodings(rgb, boxes)

            print(f"Found {len(encodings)} face(s) in {imagePath}")

            for encoding in encodings:
                knownEncodings.append(encoding)
                knownNames.append(name)

        # Load existing encodings if the file exists
        if os.path.exists(pickle_file_path):
            with open(pickle_file_path, 'rb') as f:
                data = pickle.load(f)
            knownEncodings.extend(data['encodings'])
            knownNames.extend(data['names'])

        # Save the updated encodings and names
        data = {"encodings": knownEncodings, "names": knownNames}
        with open(pickle_file_path, 'wb') as f:
            pickle.dump(data, f)

        print('--> encodings finalized')

*********************


this is settings.py 
"EMAIL_BACKEND = 'django.core.mail.backends.smtp.EmailBackend'
EMAIL_HOST = 'smtp.gmail.com'
EMAIL_PORT = 465  # Port 465 for SSL
EMAIL_USE_SSL = True  # Use SSL instead of TLS
EMAIL_USE_TLS = False  # Disable TLS since we are using SSL
EMAIL_HOST_USER = 'itkareabby@gmail.com'
EMAIL_HOST_PASSWORD = 'brlujnaodblnphia'  # Use your actual password or App Password if 2FA is enabled
DEFAULT_FROM_EMAIL = 'itkareabby@gmail.com'  # Set your default 'from' email"


*********************************
modify following code 
the problem is when i trying to filter data by date when i selecting calender and when i selected 
privious months date then input box automatically selecte current date but selected month for example 
if i selected augest in calender in it automatically selecte 25/08/2024 automatically and handle pagination
when i click on next button i wanted to show only filter data 
this is view "def preshift(request):
site_name = request.GET.get('site_name') or request.session.get('site_name')
if site_name:
    request.session['site_name'] = site_name

queryset = PreShift.objects.all()

if site_name:
    try:
        site = Site.objects.get(name=site_name)
        queryset = queryset.filter(site=site)
        print(f"Site found: {site.name}")  # Debugging print statement
    except Site.DoesNotExist:
        queryset = PreShift.objects.none()
        print(f"Site not found: {site_name}")  # Debugging print statement

paginator = Paginator(queryset, 3) 
page_number = request.GET.get('page')
preshifts = paginator.get_page(page_number)

# Filter sites based on user permissions
user = request.user
if user.is_staff and not user.is_superuser:
    # If the user is a sub-admin, get the sites associated with them
    sites = user.sites.all()
else:
    # If the user is a super admin, get all sites
    sites = Site.objects.all()

site_names = [(site.name, site.name) for site in sites]

return render(request, 'app1/preshift.html', {'preshifts': preshifts, 'site_name': site_name,'site_names':site_names})
"

this is html "<div class="filter-container">
            
    <input type="date" id="selected_date">
</div>"

this is java script to filter data by date "<script>
    document.addEventListener('DOMContentLoaded', () => {
        const dateInput = document.getElementById('selected_date');
        const table = document.getElementById('customers');
        
        // Function to format a Date object as "Month Day, Year"
        function formatDate(date) {
            const options = { year: 'numeric', month: 'long', day: 'numeric' };
            return date.toLocaleDateString('en-US', options);
        }
        
        dateInput.addEventListener('input', () => {
            const selectedDate = dateInput.value;
            if (!selectedDate) {
                // If no date is selected, show all rows
                table.querySelectorAll('tr[data-date]').forEach(row => {
                    row.style.display = '';
                });
                return;
            }
    
            // Convert selectedDate from 'yyyy-mm-dd' to 'Month Day, Year'
            const selectedDateObj = new Date(selectedDate);
            const formattedSelectedDate = formatDate(selectedDateObj);
            
            table.querySelectorAll('tr[data-date]').forEach(row => {
                const rowDate = row.getAttribute('data-date');
                if (rowDate === formattedSelectedDate) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            });
        });
    });
    </script>"

    .dropdownb {
        position: relative;
        display: inline-block;
    }
    
    /* Style the dropdown button */
    .toggle-btn {
        background: none;
        border: none;
        cursor: pointer;
        padding: 0;
    }
    
    /* Style for the dropdown content */
    .dropdown-contentb {
        display: none;
        position: absolute;
        top: 100%; /* Position the dropdown content directly below the button */
        left: -28px; /* Align the dropdown content to the left */
        box-shadow: 0 8px 14px rgba(0, 0, 0, 0.2);
        z-index: 1;
        min-width: 70px;
    }
    
    /* Links inside the dropdown */
    .dropdown-contentb a {
        color: black;
        padding: 7px 9px;
        text-decoration: none;
        display: block;
    }
    
    
    /* Use :hover to display the dropdown when the button is hovered */
    .dropdownb:hover .dropdown-contentb {
        display: block;
    }
    
    /* Additional styling for the button icon */
    .btn-icon {
        background: none; /* Remove background color */
        border: none;     /* Remove border */
        color: inherit;   /* Inherit text color */
        cursor: pointer;  /* Pointer cursor */
        padding: 0;       /* Remove padding */
    }
    
    .btn-icon i {
        font-size: 16px;  /* Adjust icon size if needed */
    }


    .content {
        margin-left: 250px;
        padding: 20px;
    }

    #table-container {
        margin-top: 10px;
        margin-left: -10px;
        margin-right: 50px;
        background-color: #ffffff;
        width: 100%;
        overflow-y: auto; /* Allow vertical scrolling */
        height: calc(100vh - 100px); /* Adjust height according to your needs */
    }

    #customers {
        width: 100%;
        border-collapse: collapse;
        margin-bottom: 20px;
    }
    
    #customers th,
    #customers td {
        padding: 8px 10px;
        text-align: center;
        border-bottom: 1px solid #ddd;
    }
    
    #customers th {
        background-color: #e3e7ea;
        font-weight: bold;
    }
    
    #customers tbody tr:nth-child(even) {
        background-color: #f9f9f9;
    }


    .add {
        background-color: #071390;
        color: white;
        padding: 8px;
        border: solid;
        margin-top: 10px;
        display: inline-block;
        text-decoration: none;
        border-radius: 7px 7px;
    }

    .user {
        text-align: left;
        margin-top: 50px;
        margin-left: -10px;
    }

    .filter-container {
        text-align: right; /* Aligns the filter form to the right */
        margin-bottom: 20px; /* Add some space below the filter */
    }
    
    /* Optional: Style the filter form */
    .filter-container form {
        display: inline-block; /* Keeps the label and input on the same line */
    }
    
    .filter-container label,
    .filter-container input[type="date"],
    .filter-container button {
        margin: 5px; /* Add some space around form elements */
    }
    
    .dropdownl {
        position: relative;
        display: inline-block;
        margin-left:30px;
        padding:-5px;
       
    }
    
    /* Style for the dropdown link */
    .dropdown-link {
        display: block;
        padding: 10px 15px;
        color: #333;
        text-decoration: none;
        background-color: #f8f9fa;
        border: 1px solid #ddd;
        border-radius: 4px;
        cursor: pointer;
        font-size: 10px;
        transition: background-color 0.3s ease;
    }
    
    .dropdown-link:hover {
        background-color: #e2e6ea;
    }
    
    /* Hidden by default (not displayed) */
    .dropdown-contentl {
        display: none;
        position: absolute;
        background-color: #ffffff;
        min-width: 160px;
        box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
        z-index: 1;
        border: 1px solid #ddd;
        border-radius: 4px;
    }
    
    /* Style for dropdown items */
    .dropdown-contentl a {
        color: #333;
        text-decoration: none;
        display: block;
        font-size: 12px;
        transition: background-color 0.3s ease;
        text-align:center;
       
    }
    
    .dropdown-contentl a:hover {
        background-color: #f1f1f1;
    }
    
    /* Show the dropdown content on hover */
    .dropdownl:hover .dropdown-contentl {
        display: block;
    }
    
    /* Adjust dropdown link for better alignment */
    .dropdown-link {
        display: flex;
        align-items: center;
        padding:-5px;
    }
    
    .dropdown-link i {
        margin-right: 8px;
        font-size:10px;
    }

